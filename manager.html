<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Stoppin - Parking Lot Manager</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <link rel="icon" type="image/png" href="img/icon.title.png" />
        <link rel="stylesheet" type="text/css" href="styles/fonts.css">
        <link rel="stylesheet" href="styles/manager.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <style>
            .modal-header, h4, .close {
              background-color: #272B9B;
              color:white !important;
              text-align: center;
              font-size: 30px;
            }
            .h4{
                font-family: 'Bebas Neue', cursive;
            }
        </style>
    </head>
    <body>
        <div class="wrap">
            <header>
                <div class="logo">Stoppin</div>
                <div class="menu">
                    <ul>
                        <li><a href="index.html">Página inicial</a></li>
                        <li><a href="manager.html">Gerenciamento</a></li>
                        <li><a href="about.html">Sobre nós</a></li>
                    </ul>
                </div>
            </header>
            <div class="rows">
                <div class="col">
                    <h1>Gerenciamento</h1>
                    <p>
                        Aqui você pode admnistrar todas as vagas e ocupações do seu estacionamento
                    </p>
                </div>
                <div class="col">
                    <div class="card card1" id="addVeiculo">
                    </div>
                    <div class="card card2" id="remVeiculo">
                    </div>
                    <div class="card card666" id="admEstacionamento">
                    </div>
                    <div class="card card4" id="addCliente">
                    </div>
                    <div class="card card5" id="remCliente">
                    </div>
                    <div class="card card6" id="editCliente">
                    </div>
                </div>
            </div>
        </div>
        <!--Administrar Estacionamento-->
        <div class="modal fade" id="modelAdmEstacionamento" role="dialog">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header" style="padding:35px 50px;">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4>Administração do Estacionamento</h4>
                </div>
                <div class="modal-body" style="padding:40px 50px;">
                    <form role="form">
                    <label for="relVagas"><span class="glyphicon glyphicon-align-justify"></span> Relação de vagas</label>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="cardmenu" id="E1">E1</div>
                            <div class="cardmenu" id="E2">E2</div>
                            <div class="cardmenu" id="E3">E3</div>
                            <div class="cardmenu" id="E4">E4</div>
                            <div class="cardmenu" id="E5">E5</div>
                        </div>
                        <div class="col-md-3">
                            <div class="cardmenu" id="E6">E6</div>
                            <div class="cardmenu" id="E7">E7</div>
                            <div class="cardmenu" id="E8">E8</div>
                            <div class="cardmenu" id="E9">E9</div>
                            <div class="cardmenu" id="E10">E10</div>
                        </div>
                        <div class="col-md-3">
                            <div class="cardmenu" id="E11">E11</div>
                            <div class="cardmenu" id="E12">E12</div>
                            <div class="cardmenu" id="E13">E13</div>
                            <div class="cardmenu" id="E14">E14</div>
                            <div class="cardmenu" id="E15">E15</div>
                        </div>
                        <div class="col-md-3">
                            <div class="cardmenu" id="E16">E16</div>
                            <div class="cardmenu" id="E17">E17</div>
                            <div class="cardmenu" id="E18">E18</div>
                            <div class="cardmenu" id="E19">E19</div>
                            <div class="cardmenu" id="E20">E20</div>
                        </div>
                    </div>
                    <div class="form-group">
                      <label for="valorHora"><span class="glyphicon glyphicon-dashboard"></span> Valor da hora</label>
                      <input type="text" class="form-control" id="valorHora">
                    </div>
                    <div class="form-group">
                      <label for="valorMensal"><span class="glyphicon glyphicon-dashboard"></span> Valor Mensal</label>
                      <input type="text" class="form-control" id="valorMensal">
                    </div>
                    <div class="form-group">
                      <button type="submit" class="btn btn-success btn-default pull-left" data-dismiss="modal" onclick="EditarValores()"><span class="glyphicon glyphicon-ok"></span> Editar Valores</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        <!--Adicionar Cliente-->
        <div class="modal fade" id="modeladdCliente" role="dialog">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header" style="padding:35px 50px;">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4>Adicionar cliente</h4>
                </div>
                <div class="modal-body" style="padding:40px 50px;">
                  <form role="form">
                    <div class="form-group">
                      <label for="nomeCliente"><span class="glyphicon glyphicon-user"></span> Nome</label>
                      <input type="text" class="form-control" id="nomeClienteAdd" placeholder="Digite o nome">
                    </div>
                    <div class="form-group">
                      <label for="cpfCliente"><span class="glyphicon glyphicon-file"></span> CPF</label>
                      <input type="text" class="form-control" id="cpfClienteAdd" placeholder="Digite o cpf">
                    </div>
                    <div class="form-group">
                        <label for="telefoneCliente"><span class="glyphicon glyphicon-earphone"></span> Telefone</label>
                        <input type="text" class="form-control" id="telefoneClienteAdd" placeholder="Digite o telefone">
                      </div>
                      <div class="form-group">
                        <label for="emailCliente"><span class="glyphicon glyphicon-envelope"></span> E-mail</label>
                        <input type="text" class="form-control" id="emailClienteAdd" placeholder="Digite o e-mail">
                      </div>
                      <div class="modal-footer">
                        <button type="submit" class="btn btn-danger btn-default pull-left" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> Cancel</button>
                        <button type="submit" class="btn btn-success btn-default pull-left" data-dismiss="modal" onclick="AdicionarCliente()"><span class="glyphicon glyphicon-ok"></span> Cadastrar</button>
                      </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <!--Remover Cliente-->
          <div class="modal fade" id="modelremCliente" role="dialog">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header" style="padding:35px 50px;">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4>Remover cliente</h4>
                </div>
                <div class="modal-body" style="padding:40px 50px;">
                  <form role="form">
                    <div class="form-group">
                      <label for="cpfCliente"><span class="glyphicon glyphicon-file"></span> CPF</label>
                      <input type="text" class="form-control" id="cpfClienteRemove" placeholder="Digite o cpf">
                    </div>
                      <div class="modal-footer">
                        <button data-toggle="modal" data-target="#modelConfirm" type="button" class="btn btn-danger btn-default pull-left" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> Remover</button>
                      </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <!--Confirmação Remover-->
          <div class="modal fade" id="modelConfirm" role="dialog">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header" style="padding:35px 50px;">
                  <h4>Confirmar remoção</h4>
                </div>
                <div class="modal-body" style="padding:40px 50px;">
                  <form role="form">
                    <div class="form-group">
                      <label for="cpfCliente"><span class="glyphicon glyphicon-file"></span> Tem certeza que deseja remover ?</label>
                    </div>
                      <div class="modal-footer">
                        <button type="submit" class="btn btn-success btn-default pull-left" data-dismiss="modal" id="btnSimRem" onclick="RemoverCliente()"><span class="glyphicon glyphicon-ok"></span> Sim</button>
                        <button type="submit" class="btn btn-danger btn-default pull-left" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> Não</button>
                      </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <!--Editar Cliente-->
          <div class="modal fade" id="modeleditCliente" role="dialog">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header" style="padding:35px 50px;">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4><span class="glyphicon glyphicon-user"></span>Editar cliente</h4>
                </div>
                <div class="modal-body" style="padding:40px 50px;">
                  <form role="form">
                    <div class="form-group">
                      <label for="cpfCliente"><span class="glyphicon glyphicon-file"></span> CPF</label>
                      <input type="text" class="form-control" id="cpfClienteEditSearch" placeholder="Digite o cpf">
                    </div>
                      <div class="modal-footer">
                        <button data-toggle="modal" data-target="#modelalterCliente" type="button" class="btn btn-default btn-default pull-left" data-dismiss="modal" onclick="BuscarClieteEditar()"><span class="glyphicon glyphicon-pencil"></span> Editar</button>
                      </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <!--Edição Cliente-->
          <div class="modal fade" id="modelalterCliente" role="dialog">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header" style="padding:35px 50px;">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4>Editar cliente</h4>
                </div>
                <div class="modal-body" style="padding:40px 50px;">
                  <form role="form">
                    <div class="form-group">
                      <label for="nomeCliente"><span class="glyphicon glyphicon-user"></span> Nome</label>
                      <input type="text" class="form-control" id="nomeClienteEdit" placeholder="Digite o nome">
                    </div>
                    <div class="form-group">
                      <label for="cpfCliente"><span class="glyphicon glyphicon-file"></span> CPF</label>
                      <input type="text" class="form-control" id="cpfClienteEdit" placeholder="Digite o cpf">
                    </div>
                    <div class="form-group">
                        <label for="telefoneCliente"><span class="glyphicon glyphicon-earphone"></span> Telefone</label>
                        <input type="text" class="form-control" id="telefoneClienteEdit" placeholder="Digite o telefone">
                      </div>
                      <div class="form-group">
                        <label for="emailCliente"><span class="glyphicon glyphicon-envelope"></span> E-mail</label>
                        <input type="text" class="form-control" id="emailClienteEdit" placeholder="Digite o e-mail">
                      </div>
                      <div class="modal-footer">
                        <button type="submit" class="btn btn-success btn-default pull-left" data-dismiss="modal" onclick="SalvarClienteEditar()"><span class="glyphicon glyphicon-ok"></span> Salvar</button>      
                      </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <!--Adicionar Veículo-->
          <div class="modal fade" id="modeladdVeiculo" role="dialog">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header" style="padding:35px 50px;">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4>Reservar Vaga</h4>
                </div>
                <div class="modal-body" style="padding:40px 50px;">
                  <form role="form">
                    <div class="form-group">
                      <label for="nomeCliente"><span class="glyphicon glyphicon-tag"></span> Placa</label>
                      <input type="text" class="form-control" id="placaVeiculo" placeholder="Digite a placa do veículo">
                    </div>
                    <div class="form-group">
                      <label for="cpfCliente"><span class="glyphicon glyphicon-file"></span> CPF</label>
                      <input type="text" class="form-control" id="cpfClienteAdicionarVaga" placeholder="Digite o CPF" onblur="BuscaClienteCadastro()">
                    </div>
                    <div class="form-group">
                        <label for="vagasDisp"><span class="glyphicon glyphicon-paste"></span> Vagas disponível</label>
                        <select class="form-control" id="vagasSelect"></select>
                      </div>
                    <div class="form-group">
                        <label for="nomeClienteAdicionarVaga"><span class="glyphicon glyphicon-file"></span> Nome</label>
                        <input readonly type="text" class="form-control" id="nomeClienteAdicionarVaga">
                      </div>
                    <div class="form-group">
                        <label for="telefoneClienteAdicionarVaga"><span class="glyphicon glyphicon-earphone"></span> Telefone</label>
                        <input readonly type="text" class="form-control" id="telefoneClienteAdicionarVaga">
                      </div>
                      <div class="form-group">
                        <label for="emailClienteAdicionarVaga"><span class="glyphicon glyphicon-envelope"></span> E-mail</label>
                        <input readonly type="text" class="form-control" id="emailClienteAdicionarVaga">
                      </div>
                      <div class="modal-footer">
                        <button type="submit" class="btn btn-danger btn-default pull-left" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> Cancel</button>
                        <button type="submit" class="btn btn-success btn-default pull-left" data-dismiss="modal"><span class="glyphicon glyphicon-ok"></span> Adicionar</button>
                      </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <!--Remover Veículo-->
          <div class="modal fade" id="modelremVeiculo" role="dialog">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header" style="padding:35px 50px;">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4>Remover reserva</h4>
                </div>
                <div class="modal-body" style="padding:40px 50px;">
                  <form role="form">
                    <div class="form-group">
                        <label for="vagasDisp"><span class="glyphicon glyphicon-paste"></span> Vagas ocupadas</label>
                        <select class="form-control" id="vagasSelect"></select>
                      </div>
                    <div class="form-group">
                      <div class="modal-footer">
                        <button data-toggle="modal" data-target="#modelConfirm" type="button" class="btn btn-danger btn-default pull-left" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> Remover</button>
                      </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <!--A partir daqui não sobrevive nada-->
        <script>
            var APIRUL = "http://localhost:8080/";
            var valores = [];

            function AdicionarCliente(){
              let cliente = {
                cpf : $('#cpfClienteAdd').val(),
                email : $('#emailClienteAdd').val(),
                name : $('#nomeClienteAdd').val(),
                telefone : $('#telefoneClienteAdd').val(),
              };

              $.ajax({
                type: "POST",
                url: APIRUL + "api/Client",
                data: JSON.stringify(cliente),
                success: function(data) { 
                    alert("Cliente cadastrado com sucesso.");
                  },
                  statusCode: {
                    400: function(response) {
                      alert('CPF já cadastrado.');
                    },
                    500: function(response){
                      alert('Occoreu um erro inesperado');
                    }
                  },
                contentType: "application/json",
                dataType: 'json'
              });
            };

            function RemoverCliente(){
              var cpf = $('#cpfClienteRemove').val();

              $.ajax({
                type: "DELETE",
                url: APIRUL + "api/Client/deleteByCPF?cpf=" + cpf,
                success: function(data) { 
                    alert("Cliente removido com sucesso.");
                  },
                  statusCode: {
                    400: function(response) {
                      alert('CPF não existe.');
                    },
                    500: function(response){
                      alert('Occoreu um erro inesperado');
                    }
                  },
                contentType: "application/json",
                dataType: 'json'
              });
            };

            function BuscarClieteEditar(){
              var cpf = $('#cpfClienteEditSearch').val();

              $.ajax({
                type: "GET",
                url: APIRUL + "api/Client/cpf?cpf=" + cpf,
                success: function(data) { 
                    $('#nomeClienteEdit').val(data.name);
                    $('#cpfClienteEdit').val(data.cpf);
                    $('#telefoneClienteEdit').val(data.telefone);
                    $('#emailClienteEdit').val(data.email);
                  },
                  statusCode: {
                    400: function(response) {
                      alert('CPF não existe.');
                    },
                    500: function(response){
                      alert('Occoreu um erro inesperado');
                    }
                  },
                contentType: "application/json",
                dataType: 'json'
              });
            };

            function SalvarClienteEditar(){
              let cliente = {
                cpf : $('#cpfClienteEdit').val(),
                email : $('#emailClienteEdit').val(),
                name : $('#nomeClienteEdit').val(),
                telefone : $('#telefoneClienteEdit').val(),
              };

              $.ajax({
                type: "PUT",
                url: APIRUL + "api/Client",
                data: JSON.stringify(cliente),
                success: function(data) {
                    alert("Cliente editado com sucesso");
                  },
                  statusCode: {
                    500: function(response){
                      alert('Occoreu um erro inesperado');
                    }
                  },
                contentType: "application/json",
                dataType: 'json'
              });
            };

            function BuscaClienteCadastro(){
              var cpf = $('#cpfClienteAdicionarVaga').val();
              $.ajax({
                type: "GET",
                url: APIRUL + "api/Client/cpf?cpf=" + cpf,
                success: function(data) {
                    $('#nomeClienteAdicionarVaga').val(data.name);
                    $('#telefoneClienteAdicionarVaga').val(data.telefone);
                    $('#emailClienteAdicionarVaga').val(data.email);
                  },
                  statusCode: {
                    500: function(response){
                      alert('Occoreu um erro inesperado');
                    }
                  },
                contentType: "application/json",
                dataType: 'json'
              });
            };

            function BuscarOcupacaoDasVagasADM(){
              $.ajax({
                type: "GET",
                url: APIRUL + "api/ParkSlot",
                success: function(data) {
                  data.forEach(element => {
                    if(element.occupied == true){
                      $('#' + element.name).css('background-color', '#ee394d');
                    }
                    else{
                      $('#' + element.name).css('background-color', '#006600');
                    }
                  });
                },
                statusCode: {
                  500: function(response){
                    alert('Occoreu um erro inesperado');
                    return null;
                  }
                },
                contentType: "application/json",
                dataType: 'json'
              });
            }

            function BuscaValorDaHoraADM(){
              $.ajax({
                type: "GET",
                url: APIRUL + "api/Value",
                success: function(data) {
                  data.forEach(element => {
                    if(element.occupationType == "MENSALISTA"){
                      $('#valorMensal').val(element.value);
                      valores.push(element);
                    }
                    else{
                      $('#valorHora').val(element.value)
                      valores.push(element);
                    }
                  });
                },
                statusCode: {
                  500: function(response){
                    alert('Occoreu um erro inesperado');
                    return null;
                  }
                },
                contentType: "application/json",
                dataType: 'json'
              });
            }

            function EditarValores(){
              let hora = $('#valorHora').val();
              let mes = $('#valorMensal').val();
              
              let valorMes = valores.find(element => element.occupationType == "MENSALISTA");
              let valorHora = valores.find(element => element.occupationType == "HORA");

              valorMes.value = mes;
              valorHora.value = hora;

              $.ajax({
                type: "PUT",
                url: APIRUL + "api/Value",
                data: JSON.stringify(valorMes),
                success: function(data) {
                  alert("Valor mensal alterado com sucesso");
                },
                statusCode: {
                  500: function(response){
                    alert('Occoreu um erro inesperado');
                    return null;
                  }
                },
                contentType: "application/json",
                dataType: 'json'
              });

              $.ajax({
                type: "PUT",
                url: APIRUL + "api/Value",
                data: JSON.stringify(valorHora),
                success: function(data) {
                  alert("Valor da hora alterado com sucesso");
                },
                statusCode: {
                  500: function(response){
                    alert('Occoreu um erro inesperado');
                    return null;
                  }
                },
                contentType: "application/json",
                dataType: 'json'
              });
            }

            $(document).ready(function(){
                $("#addVeiculo").click(function(){
                    $('#modeladdVeiculo').modal();
                });
                $("#remVeiculo").click(function(){
                    $('#modelremVeiculo').modal();
                });
                $("#admEstacionamento").click(function(){
                    $('#modelAdmEstacionamento').modal();
                    BuscarOcupacaoDasVagasADM();
                    BuscaValorDaHoraADM();
                }); 
                $("#addCliente").click(function(){
                    $('#modeladdCliente').modal();
                });
                $("#remCliente").click(function(){
                    $('#modelremCliente').modal();
                });
                $("#editCliente").click(function(){
                    $('#modeleditCliente').modal();
                }); 
            });

        </script>
    </body>
</html>